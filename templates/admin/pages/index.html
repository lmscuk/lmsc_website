{% extends 'admin/base_admin.html' %} {% block nav_title %}Page Management{%
endblock %} {% block title %}Page Management · LMSC Admin{% endblock %} {% block
meta_description %}
<meta
  name="description"
  content="Manage static pages, SEO metadata and navigation visibility from the LMSC admin page manager."
/>
{% endblock %} {% block extra_head %}
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
/>
{% endblock %} {% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    $("#page-table").DataTable({
      pageLength: 25,
      order: [[5, "desc"]],
      columnDefs: [{ orderable: false, targets: [6] }],
    });
  });
</script>
{% endblock %} {% block content %}
<header
  class="mb-10 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
>
  <div>
    <h1 class="text-3xl font-bold text-slate-900">Page Management</h1>
    <p class="text-sm text-slate-500 mt-1">
      Control SEO metadata, navigation visibility, and templates for every
      public page.
    </p>
  </div>
  <a
    href="{{ url_for('admin_pages_new') }}"
    class="inline-flex items-center gap-2 rounded-full bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-primary/90"
  >
    <svg
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
      class="h-4 w-4"
      aria-hidden="true"
    >
      <path d="M12 5v14m7-7H5" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    Create new page
  </a>
</header>

{% if nav_stats %}
<section class="mb-8 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">
  <article class="rounded-3xl border border-slate-100 bg-white p-5 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
      Total Pages
    </p>
    <p class="mt-2 text-2xl font-bold text-slate-900">{{ nav_stats.total }}</p>
    {% if nav_stats.nav_counts.hidden %}
    <p class="mt-1 text-xs text-slate-500">
      {{ nav_stats.nav_counts.hidden }} hidden/private pages.
    </p>
    {% endif %}
  </article>
  <article class="rounded-3xl border border-slate-100 bg-white p-5 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
      SEO Complete
    </p>
    <p class="mt-2 text-2xl font-bold text-emerald-700">
      {{ nav_stats.meta_complete }}/{{ nav_stats.total }}
    </p>
    {% if nav_stats.meta_missing %}
    <p class="mt-1 text-xs text-slate-500">
      {{ nav_stats.meta_missing }} pages need metadata.
    </p>
    {% endif %}
  </article>
  <article class="rounded-3xl border border-slate-100 bg-white p-5 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
      In Navigation
    </p>
    <p class="mt-2 text-2xl font-bold text-primary">
      {{ nav_stats.nav_visible }}
      <span class="text-sm font-semibold text-slate-400">main/dropdown</span>
    </p>
  </article>
  <article class="rounded-3xl border border-slate-100 bg-white p-5 shadow-sm">
    <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
      Footer Links
    </p>
    <p class="mt-2 text-2xl font-bold text-secondary">
      {{ nav_stats.nav_footer }}
    </p>
  </article>
</section>
{% endif %}

<section class="bg-white rounded-3xl border border-slate-100 shadow-sm">
  <div class="overflow-x-auto">
    <table
      id="page-table"
      class="min-w-full divide-y divide-slate-200 text-sm display"
    >
      <thead
        class="bg-slate-50 text-xs uppercase tracking-widest text-slate-500"
      >
        <tr>
          <th class="px-6 py-3 text-left">Page</th>
          <th class="px-6 py-3 text-left">SEO</th>
          <th class="px-6 py-3 text-left">Slug</th>
          <th class="px-6 py-3 text-left">Display</th>
          <th class="px-6 py-3 text-left">Template</th>
          <th class="px-6 py-3 text-left">Updated</th>
          <th class="px-6 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 bg-white">
        {% for page in pages %} {% set view_url = page_urls.get(page['id']) or
        url_for('render_dynamic_page', slug=page['slug']) %}
        <tr class="hover:bg-slate-50">
          <td class="px-6 py-4">
            <p class="font-semibold text-slate-900">{{ page['page_name'] }}</p>
            {% if page['seo_title'] %}
            <p class="text-xs text-slate-500 mt-1 line-clamp-1">
              SEO: {{ page['seo_title'] }}
            </p>
            {% endif %} {% if page['meta_description'] %}
            <p class="text-xs text-slate-400 mt-1 line-clamp-2">
              {{ page['meta_description'] }}
            </p>
            {% endif %} {% if page['id'] in meta_gaps %}
            <p class="mt-2 text-xs font-semibold text-amber-600">
              Complete SEO fields to improve indexing.
            </p>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-wrap gap-2">
              {% set has_title = page['seo_title'] %} {% set has_description =
              page['meta_description'] %}
              <span
                class="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold {% if has_title %}border-emerald-200 bg-emerald-50 text-emerald-700{% else %}border-amber-200 bg-amber-50 text-amber-700{% endif %}"
              >
                <span
                  class="h-2 w-2 rounded-full {% if has_title %}bg-emerald-500{% else %}bg-amber-500{% endif %}"
                ></span>
                Title
              </span>
              <span
                class="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold {% if has_description %}border-emerald-200 bg-emerald-50 text-emerald-700{% else %}border-amber-200 bg-amber-50 text-amber-700{% endif %}"
              >
                <span
                  class="h-2 w-2 rounded-full {% if has_description %}bg-emerald-500{% else %}bg-amber-500{% endif %}"
                ></span>
                Description
              </span>
            </div>
          </td>
          <td class="px-6 py-4">
            <a
              href="{{ view_url }}"
              class="hover:text-primary"
              target="_blank"
              rel="noopener"
            >
              <code
                class="rounded bg-slate-100 px-2 py-1 text-xs text-slate-600"
                >{{ page['slug'] }}</code
              >
            </a>
          </td>
          <td class="px-6 py-4">
            {% if page['nav_display'] == 'main' %}
            <span
              class="inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700"
              >Main nav</span
            >
            {% elif page['nav_display'] == 'dropdown' %}
            <span
              class="inline-flex items-center rounded-full bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700"
              >Dropdown</span
            >
            {% elif page['nav_display'] == 'footer' %}
            <span
              class="inline-flex items-center rounded-full bg-lime-50 px-3 py-1 text-xs font-semibold text-lime-700"
              >Footer</span
            >
            {% else %}
            <span
              class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600"
              >Hidden</span
            >
            {% endif %}
          </td>
          <td class="px-6 py-4 text-slate-500">
            {{ page['template_name'] }} {% if page['nav_parent_id'] and
            parent_lookup.get(page['nav_parent_id']) %}
            <p class="text-xs text-slate-400 mt-1">
              Parent: {{ parent_lookup.get(page['nav_parent_id']) }}
            </p>
            {% endif %}
          </td>
          <td
            class="px-6 py-4 text-slate-500"
            data-order="{{ page['updated_at'] or '' }}"
          >
            {{ page['updated_at'] or '—' }}
          </td>
          <td class="px-6 py-4">
            <div class="flex items-center gap-2">
              <a
                href="{{ view_url }}"
                class="text-xs font-semibold text-primary hover:underline"
                target="_blank"
                rel="noopener"
                >View</a
              >
              <a
                href="{{ url_for('admin_pages_edit', page_id=page['id']) }}"
                class="text-xs font-semibold text-slate-600 hover:text-primary"
                >Edit</a
              >
              <form
                method="post"
                action="{{ url_for('admin_pages_delete', page_id=page['id']) }}"
                onsubmit="return confirm('Delete this page? This cannot be undone.');"
              >
                <button
                  type="submit"
                  class="text-xs font-semibold text-red-600 hover:text-red-500"
                >
                  Delete
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="px-6 py-8 text-center text-slate-500">
            No managed pages yet. Create one to begin configuring SEO and
            navigation.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
