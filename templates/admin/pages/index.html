{% extends 'admin/base_admin.html' %} {% block nav_title %}Page Management{%
endblock %} {% block title %}Page Management · LMSC Admin{% endblock %} {% block
extra_head %}
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
/>
{% endblock %} {% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    $("#page-table").DataTable({
      pageLength: 25,
      order: [[4, "desc"]],
      columnDefs: [{ orderable: false, targets: [5] }],
    });
  });
</script>
{% endblock %} {% block content %}
<header
  class="mb-10 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
>
  <div>
    <h1 class="text-3xl font-bold text-slate-900">Page Management</h1>
    <p class="text-sm text-slate-500 mt-1">
      Control SEO metadata, navigation visibility, and templates for every
      public page.
    </p>
  </div>
  <a
    href="{{ url_for('admin_pages_new') }}"
    class="inline-flex items-center gap-2 rounded-full bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-primary/90"
  >
    <svg
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
      class="h-4 w-4"
      aria-hidden="true"
    >
      <path d="M12 5v14m7-7H5" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    Create new page
  </a>
</header>

<section class="bg-white rounded-3xl border border-slate-100 shadow-sm">
  <div class="overflow-x-auto">
    <table
      id="page-table"
      class="min-w-full divide-y divide-slate-200 text-sm display"
    >
      <thead
        class="bg-slate-50 text-xs uppercase tracking-widest text-slate-500"
      >
        <tr>
          <th class="px-6 py-3 text-left">Page</th>
          <th class="px-6 py-3 text-left">Slug</th>
          <th class="px-6 py-3 text-left">Display</th>
          <th class="px-6 py-3 text-left">Template</th>
          <th class="px-6 py-3 text-left">Updated</th>
          <th class="px-6 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 bg-white">
        {% for page in pages %}
        <tr class="hover:bg-slate-50">
          <td class="px-6 py-4">
            <p class="font-semibold text-slate-900">{{ page['page_name'] }}</p>
            {% if page['seo_title'] %}
            <p class="text-xs text-slate-500 mt-1 line-clamp-1">
              SEO: {{ page['seo_title'] }}
            </p>
            {% endif %} {% if page['meta_description'] %}
            <p class="text-xs text-slate-400 mt-1 line-clamp-2">
              {{ page['meta_description'] }}
            </p>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <code class="rounded bg-slate-100 px-2 py-1 text-xs text-slate-600"
              >{{ page['slug'] }}</code
            >
          </td>
          <td class="px-6 py-4">
            {% if page['nav_display'] == 'main' %}
            <span
              class="inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700"
              >Main nav</span
            >
            {% elif page['nav_display'] == 'dropdown' %}
            <span
              class="inline-flex items-center rounded-full bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700"
              >Dropdown</span
            >
            {% else %}
            <span
              class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600"
              >Hidden</span
            >
            {% endif %}
          </td>
          <td class="px-6 py-4 text-slate-500">
            {{ page['template_name'] }} {% if page['nav_parent_id'] and
            parent_lookup.get(page['nav_parent_id']) %}
            <p class="text-xs text-slate-400 mt-1">
              Parent: {{ parent_lookup.get(page['nav_parent_id']) }}
            </p>
            {% endif %}
          </td>
          <td
            class="px-6 py-4 text-slate-500"
            data-order="{{ page['updated_at'] or '' }}"
          >
            {{ page['updated_at'] or '—' }}
          </td>
          <td class="px-6 py-4">
            <div class="flex items-center gap-2">
              <a
                href="{{ url_for('render_dynamic_page', slug=page['slug']) }}"
                class="text-xs font-semibold text-primary hover:underline"
                target="_blank"
                rel="noopener"
                >View</a
              >
              <a
                href="{{ url_for('admin_pages_edit', page_id=page['id']) }}"
                class="text-xs font-semibold text-slate-600 hover:text-primary"
                >Edit</a
              >
              <form
                method="post"
                action="{{ url_for('admin_pages_delete', page_id=page['id']) }}"
                onsubmit="return confirm('Delete this page? This cannot be undone.');"
              >
                <button
                  type="submit"
                  class="text-xs font-semibold text-red-600 hover:text-red-500"
                >
                  Delete
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="px-6 py-8 text-center text-slate-500">
            No managed pages yet. Create one to begin configuring SEO and
            navigation.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
